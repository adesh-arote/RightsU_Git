function GetDealTypeCondition(e) { return e == Deal_Type_Content || e == Deal_Type_Sports || e == Deal_Type_Format_Program || e == Deal_Type_Event || e == Deal_Type_Documentary_Show ? Deal_Program : e == Deal_Type_Music || e == Deal_Type_ContentMusic ? Deal_Music : e == Deal_Type_Movie ? Deal_Movie : Sub_Deal_Talent } function SetNull() { txtMovie_Closed_Date = txtClosing_Remarks = null, btnSave = btnCancel = btnDelete = btnCloseTitle = null, Acq_Deal_Movie_Code = Notes = Title_Type = Command_Name = Dummy_Guid = Row_Index = null, episode_From = episode_To = no_Of_Episodes = null } function Enable_DisableControl(e) { $("input[name='Deal_Type_Code'][type=radio]").attr("disabled", e), $("input[name='Is_Master_Deal'][type=radio]").attr("disabled", e), e ? ($("select[ID='ddlMaster_Deal_List']").attr("disabled", e), $("select[ID='ddlOther']").attr("disabled", e)) : ($("#ddlMaster_Deal_List").val() > 0 && $("select[ID='ddlMaster_Deal_List']").attr("disabled", e), $("#ddlOther").val() > 0 && $("select[ID='ddlOther']").attr("disabled", e)), $(".chosen-select:not(#ddlLicensor)").trigger("chosen:updated") } function addNumeric() { $("input.numeric").numeric({ allowMinus: !1, allowThouSep: !1, allowDecSep: !1, max: 9999, min: 1 }), $("input.numeric_music").numeric({ allowMinus: !1, allowThouSep: !1, allowDecSep: !1, max: 9999, min: 0 }), $("input.pagingSize").numeric({ allowMinus: !1, allowThouSep: !1, allowDecSep: !1, max: 100, min: 1 }) } function setPrimaryLicensor(e) { var t = $("#ddlLicensor [value=" + e + "]").index(); $("#ddlLicensor_chosen a").filter('[data-option-array-index="' + t + '"]').closest("li").addClass("primary") } function getPrimaryLicensor() { var e = $("#ddlLicensor_chosen li.search-choice.primary a").data("option-array-index"); return isNaN(e) ? 0 : (e = parseInt(e) + 1, $("#ddlLicensor option:nth-child(" + e + ")").val()) } function SetPaging() { IsCall = "N"; var e = parseInt($("#hdnPageNo").val()), t = parseInt($("#hdnRecordCount").val()), a = parseInt($("#hdnPagePerBatch").val()), i = parseInt($("#txtPageSize").val()); if (e * i >= t) { var l = parseInt(t / i); e = l * i == t ? l : l + 1 } 0 == e && (e = 1), $("#hdnPageNo").val(e); var o = e - 1, r = { callback: pageselectCallback }; r.items_per_page = i, r.num_display_entries = a, r.num = 10, r.prev_text = "<<", r.next_text = ">>", r.current_page = o, $("#Pagination").pagination(t, r) } function pageselectCallback(e, t) { if ($(".required").removeClass("required"), $("[required='required']").removeAttr("required"), "" == Command_Name && (Command_Name = null), null != Command_Name) return showAlert("E", ShowMessage.MsgForAddEdit), !1; if (!ValidatePageSize()) return !1; var a = e + 1; $("#hdnPageNo").val(a), "Y" == IsCall ? SaveTitleListData(!0) && BindTitleGridview() : IsCall = "Y" } function ValidatePageSize() { var e = $("#txtPageSize").val(); return "" != $.trim(e) && parseInt(e) > 0 || ($("#txtPageSize").addClass("required"), !1) } function txtPageSize_OnChange() { return $(".required").removeClass("required"), $("[required='required']").removeAttr("required"), "" == Command_Name && (Command_Name = null), null != Command_Name ? (showAlert("E", ShowMessage.MsgForAddEdit), !1) : !!ValidatePageSize() && void (SaveTitleListData(!0) && (BindTitleGridview(), SetPaging())) } function GetDealTypeCode() { var e = $("input[name='Deal_Type_Code']:radio:checked").val(); return e == Deal_Type_Other && (e = $("select[ID='ddlOther'] option:selected").val()), void 0 == e && (e = 0), e } function BasicValidationForAddTitle() { var e = !0, t = $("input[name='Is_Master_Deal']:radio:checked").val(), a = $("select[ID='ddlMaster_Deal_List'] option:selected").val(), i = GetDealTypeCode(); return "N" == t && 0 == a && i != Deal_Type_Music && ($("#ddlMaster_Deal_List").addClass("required"), e = !1), 0 == i && ($("#ddlOther").addClass("required"), e = !1), e } function RequiredFieldValidation() { var e = !0; e = BasicValidationForAddTitle(); var t = $("#txtAgreement_Date").val(), a = $("#txtDeal_Desc").val(), i = $("select[ID='ddlDeal_Tag'] option:selected").val(), l = $("select[ID='ddlCurrency'] option:selected").val(), o = $("select[ID='ddlLicensee'] option:selected").val(), r = $("select[ID='ddlBusinessUnit'] option:selected").val(), n = $("#ddlLicensor").val(), d = $("select[ID='ddlCategory'] option:selected").val(), s = $("#tblMovie tr:not(:has(th))").length; return "" == $.trim(t) && ($("#txtAgreement_Date").attr("required", !0), e = !1), "" == $.trim(a) && ($("#txtDeal_Desc").attr("required", !0), e = !1), 0 == i && ($("#ddlDeal_Tag").addClass("required"), e = !1), 0 == l && ($("#ddlCurrency").addClass("required"), e = !1), 0 != o && void 0 != o || ($("#ddlLicensee").addClass("required"), e = !1), 0 == r && ($("#ddlBusinessUnit").addClass("required"), e = !1), null == n ? ($("#ddlLicensor").attr("required", !0), e = !1) : 0 == getPrimaryLicensor() && (showAlert("E", ShowMessage.MsgForPrimLsr, "ddlLicensor"), e = !1), 0 == d && ($("#ddlCategory").addClass("required"), e = !1), 0 == s && e && (showAlert("E", ShowMessage.MsgForAddTitle), e = !1), e || $("#hdnTabName").val(""), e } function rblIsMasterDeal_OnChange() { BindTopBand(), "N" == $("input[name='Is_Master_Deal']:radio:checked").val() ? ($("input[name=Deal_Type_Code][value='" + Deal_Type_Other + "']").prop("checked", "checked"), $("#ddlMaster_Deal_List").attr("disabled", !1), $("#ddlOther").attr("disabled", !1), $("#hdnDeal_Type_Code").val(0)) : ($("input[name=Deal_Type_Code][value='" + Deal_Type_Movie + "']").prop("checked", "checked"), $("#ddlMaster_Deal_List").val("0"), $("#ddlOther").val("0"), $("#ddlMaster_Deal_List").attr("disabled", !0), $("#ddlOther").attr("disabled", !0), PopulateMasterDealData(), $("#hdnDeal_Type_Code").val(Deal_Type_Movie)), BindTitleLabel(!0), $(".chosen-select:not(#ddlLicensor)").trigger("chosen:updated"), BindTitleGridview() } function rblDeal_For_OnChange() { BindTopBand(); var e = $("input[name='Deal_Type_Code']:radio:checked").val(); e == Deal_Type_Other ? ($("input[name=Is_Master_Deal][value='N']").prop("checked", "checked"), $("#ddlOther").attr("disabled", !1), $("#ddlMaster_Deal_List").attr("disabled", !1), $("#hdnDeal_Type_Code").val(0)) : ($("input[name=Is_Master_Deal][value='Y']").prop("checked", "checked"), $("#ddlMaster_Deal_List").val("0"), $("#ddlOther").val("0"), $("#ddlMaster_Deal_List").attr("disabled", !0), $("#ddlOther").attr("disabled", !0), PopulateMasterDealData(), $("#hdnDeal_Type_Code").val(e)), BindTitleLabel(!0), $(".chosen-select:not(#ddlLicensor)").trigger("chosen:updated"), BindTitleGridview() } function ddlOther_OnChange() { BindTopBand(); var e = $("select[ID='ddlOther'] option:selected").val(); $("#hdnDeal_Type_Code").val(e), e == Deal_Type_Music ? ($("#ddlMaster_Deal_List").val("0"), $("#ddlMaster_Deal_List").attr("disabled", !0), PopulateMasterDealData()) : e == Deal_Type_Sports || e == Deal_Type_Format_Program || e == Deal_Type_Event || e == Deal_Type_Documentary_Show || e == Deal_Type_Documentary_Film || e == Deal_Type_ContentMusic ? ($("#ddlMaster_Deal_List").val("0"), $("#ddlMaster_Deal_List").attr("disabled", !0), $("input[name=Is_Master_Deal][value='Y']").prop("checked", "checked"), PopulateMasterDealData()) : ($("input[name=Is_Master_Deal][value='N']").prop("checked", "checked"), $("#ddlMaster_Deal_List").attr("disabled", !1)), BindTitleLabel(!0), $(".chosen-select:not(#ddlLicensor)").trigger("chosen:updated"), BindTitleGridview() } function AllowChosenRightClick() { $("#ddlLicensor_chosen li.search-choice").bind("contextmenu", function (e) { e.preventDefault(), $("#ddlLicensor_chosen li.search-choice.primary").removeClass("primary"), $(this).addClass("primary"), BindContactDropDown() }) } function btnAddTitle_OnClick() { if ($("#ddlTitle").SumoSelect(), $(".required").removeClass("required"), $("[required='required']").removeAttr("required"), "" == Command_Name && (Command_Name = null), null != Command_Name) return showAlert("E", ShowMessage.MsgForAddEdit), !1; var e = $("input[name='Is_Master_Deal']:radio:checked").val(), t = $("select[ID='ddlMaster_Deal_List'] option:selected").val(), a = GetDealTypeCode(), i = BasicValidationForAddTitle(); if (!i) return !1; if (!(i = ValidatePageSize())) return !1; if ("N" == e && a != Deal_Type_Music) { var l = $("select[ID='ddlMaster_Deal_List'] option:selected").text(), o = "( Rights will be copied from deal - {MASTER_DEAL_TEXT} )"; o = o.replace("{MASTER_DEAL_TEXT}", l), $("#subDealNote").text(o) } else $("#subDealNote").text(""); BindTitlePopup(t, a, 0, "ddlTitle"), $("#popAddDealMovie").modal(), $("#ddlTitle")[0].sumo.reload() } function ddlTitle_Search_List_OnChange() { if ($(".required").removeClass("required"), $("[required='required']").removeAttr("required"), null == $("#ddlTitle_Search_List").val()) { if (!ValidatePageSize()) return !1; SearchTitle("") } } function btnSearchTitle_Click() { if ($(".required").removeClass("required"), $("[required='required']").removeAttr("required"), "" == Command_Name && (Command_Name = null), null != Command_Name) return showAlert("E", ShowMessage.MsgForAddEdit), !1; if (!ValidatePageSize()) return !1; var e = $("#ddlTitle_Search_List").val(); titleCodes = e.join(","), null != e ? SearchTitle(titleCodes) : showAlert("E", ShowMessage.MsgForSelectTitle, "ddlTitle_Search_List") } function chkUnlimited_OnClick(e, t) { var a = $("#" + t); e.checked ? a.attr("readonly", !0).removeAttr("required").val("0").addClass("unlimitedMusic") : a.attr({ readonly: !1, required: "required" }).val("").removeClass("unlimitedMusic") } function Ask_Confirmation(e, t, a, i) { return !!ValidatePageSize() && ("" == Command_Name && (Command_Name = null), null != Command_Name ? (showAlert("E", ShowMessage.MsgForAddEdit), !1) : (Dummy_Guid = t, Row_Index = a, Command_Name = i, void ("DELETE" != i && "CLOSE_TITLE" != i && "REPLACE_TITLE" != i || showAlert("I", e, "OKCANCEL")))) } function ChangeLabelName() { var e = document.getElementById("lblLicensor"), t = parseInt($("input[name='Role_Code']:radio:checked").val()); t == Role_Assignment ? e.innerHTML = ShowMessage.lblForAssignor : t == Role_License ? e.innerHTML = ShowMessage.lblForLicensor : t == Role_Own_Production && (e.innerHTML = ShowMessage.lblForProducerLineProducer) } function ValidateEpisodeOverlapping() { var e = !0, t = 0, a = "", i = GetDealTypeCode(), l = GetDealTypeCondition(i), o = $("#tblMovie tr:not(:has(th),.deleted)"); return l == Deal_Music ? (o.each(function (i) { if (0 == e) return !1; var l = parseInt($(this).find("input[id*='hdnTitleCode']").val()), r = $(this).find("input[id*='txtEpisode_End_To'][type='text']"), n = parseInt(r.val()), d = r[0]; isNaN(n) ? ($("#" + d.id).attr("required", !0), t++) : o.each(function (o) { var s = parseInt($(this).find("input[id*='hdnTitleCode']").val()), c = $(this).find("input[id*='chkUnlimited_']")[0].checked; r = $(this).find("input[id*='txtEpisode_End_To'][type='text']"); var _ = parseInt(r.val()); if (d = r[0], isNaN(_)) $("#" + d.id).attr("required", !0), t++; else { var u = parseInt($(this).find("input[id*='hdnMininumEpisodeTo'][type='hidden']").val()); if (0 != _ || c ? _ < u && !c ? (a = ShowMessage.NoofSongEqual + u, e = !1) : n == _ && s == l && i != o && (a = Showmessage.MsgForDuplicate, e = !1) : (a = ShowMessage.NoofSongsGreaterZero, e = !1), !e) return t = 0, $("[required='required']").removeAttr("required"), $(".required").removeClass("required"), showAlert("E", a, d.id), !1 } }) }), t > 0 && (showAlert("E", ShowMessage.NoOfSongs), e = !1), e) : l == Deal_Program ? (o.each(function (l) { if (0 == e) return !1; var r = $(this).find("input[id*='txtEpisode_Starts_From'][type='text']"), n = $(this).find("input[id*='txtEpisode_End_To'][type='text']"), d = parseInt($(this).find("input[id*='hdnTitleCode']").val()), s = parseInt(r.val()), c = parseInt(n.val()); isNaN(s) || isNaN(c) ? (isNaN(s) && $("#" + r[0].id).attr("required", !0), isNaN(c) && $("#" + n[0].id).attr("required", !0), t++) : o.each(function (o) { var _ = $(this).find("input[id*='txtEpisode_Starts_From'][type='text']"), u = $(this).find("input[id*='txtEpisode_End_To'][type='text']"), p = parseInt(_.val()), h = parseInt(u.val()), m = parseInt($(this).find("input[id*='hdnTitleCode']").val()); if (isNaN(p) || isNaN(h)) isNaN(p) && $("#" + _[0].id).attr("required", !0), isNaN(h) && $("#" + u[0].id).attr("required", !0), t++; else { var T = null, v = null; 0 == p || 0 == h ? (0 == p && (T = _[0]), 0 == h && (v = u[0]), a = ShowMessage.EpisodeNoComp, i == Deal_Type_Sports && (a = ShowMessage.NoofMatchesgreater0), e = !1) : p > h && (T = null, v = u[0], a = i == Deal_Type_Sports ? ShowMessage.MatchesFromTo : ShowMessage.EpisodeFromTo, e = !1); var C = parseInt($(this).find("input[id*='hdnMaximumEpisodeFrom'][type='hidden']").val()), D = parseInt($(this).find("input[id*='hdnMininumEpisodeTo'][type='hidden']").val()); if (isNaN(C) || isNaN(D) || !e || (p > C && C > 0 && (T = _[0], v = null, a = ShowMessage.MsgForEpisodeNo + C, e = !1), h < D && D > 0 && e && (a = i == Deal_Type_Sports ? ShowMessage.NoofMatchesComp + D : ShowMessage.NoOfEpisodeComp + D, T = null, v = u[0], e = !1), l != o && m == d && e && (T = null, v = null, p >= s && p <= c && (T = _[0], e = !1), h >= s && h <= c && e && (v = u[0], e = !1), s >= p && s <= h && e && (T = r[0], e = !1), c >= p && c <= h && e && (v = n[0], e = !1), e || (a = ShowMessage.MsgoverlappEpisode, i == Deal_Type_Sports && (a = ShowMessage.MsgoverlappMatches)))), !e) return t = 0, $("[required='required']").removeAttr("required"), $(".required").removeClass("required"), null != T && $("#" + T.id).addClass("required"), null != v && $("#" + v.id).addClass("required"), showAlert("E", a), !1 } }) }), t > 0 && (a = ShowMessage.NoOfEpisode, i == Deal_Type_Sports ? a = ShowMessage.NoOfMatches : i != Deal_Type_Music && i != Deal_Type_ContentMusic || (a = ShowMessage.NoOfSongs), showAlert("E", a), e = !1), e) : l != Sub_Deal_Talent || ($(this).find("input[id*='txtNo_Of_Episodes'][type='text']").length > 0 && (o.each(function (a) { if (0 == e) return !1; var i = $(this).find("input[id*='txtNo_Of_Episodes'][type='text']"), l = i[0], o = parseInt(i.val()); if (isNaN(o)) $("#" + l.id).attr("required", !0), t++; else if (0 == o) return showAlert("E", ShowMessage.MsgAppearanceComp, l.id), e = !1, !1 }), t > 0 && (showAlert("E", ShowMessage.NoOfAppearance), e = !1)), e) } function CancelSaveDeal() { Command_Name = "CANCEL_SAVE_DEAL", showAlert("I", ShowMessage.MsgForunsavedData, "OKCANCEL") } function BindTitleGridview() { var e = $("#hdnPageNo").val(), t = GetDealTypeCode(), a = $("select[ID='ddlMaster_Deal_List'] option:selected").val(); void 0 == a && (a = 0); var i = $("#txtPageSize").val(); $.ajax({ type: "POST", url: URL_BindTitleGridview, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ dealTypeCode: t, masterDealMovieCode: a, pageNo: e, recordPerPage: i }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : ($("#subDealMovie").empty(), $("#subDealMovie").html(e)) }, error: function (e) { alert("Error: " + e.responseText) } }), initializeTooltip(), initializeDatepicker(), initializeExpander() } function BindTopBand() { var e = GetDealTypeCode(), t = $("#txtDeal_Desc").val(), a = $("#txtAgreement_Date").val(), i = $("#ddlDeal_Tag").val(), l = $("#hdnDeal_Type_Code").val(); e != Deal_Type_Sports && l != Deal_Type_Sports || $.ajax({ type: "POST", url: URL_BindTopBand, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ dealTypeCode: e, dealDesc: t, agreementDate: a, dealTagCode: i, IsAmort: isAmort }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : ($("#divTopBand").empty(), $("#divTopBand").html(e)) }, error: function (e) { alert("Error: " + e.responseText) } }) } function PopulateMasterDealData() { var e = $("select[ID='ddlMaster_Deal_List'] option:selected").val(), t = $("#hdnPreviousADMCode").val(); (t > 0 || e > 0) && $.ajax({ type: "POST", url: URL_PopulateMasterDealData, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ currentADMCode: e, priviousADMCode: t }), async: !1, success: function (e) { if ("true" == e) redirectToLogin(); else { $("#ddlCurrency").val(e.Currency_Code), $("#ddlLicensee").val(e.Entity_Code), $("#ddlBusinessUnit").val(e.Business_Unit_Code), $("#ddlCategory").val(e.Category_Code), $("#ddlLicensor").val(e.Vendor_Code), $("#hdnVendorCodes").val(e.Selected_Vendor_Codes); var t = e.Selected_Vendor_Codes; $("select#ddlLicensor.form_input.chosen-select").val(t.split(",")).trigger("chosen:updated"), setPrimaryLicensor(e.Vendor_Code), AllowChosenRightClick(), BindContactDropDown(), $("#ddlContact").val(e.Vendor_Contact_Code), $(".chosen-select:not(#ddlLicensor)").trigger("chosen:updated"), ddlContact_OnChange() } }, error: function (e) { alert("Error: " + e.responseText) } }), $("#hdnPreviousADMCode").val(e) } function BindTitleLabel(e) { var t = GetDealTypeCode(); t > 0 ? $.ajax({ type: "POST", url: URL_BindTitleLabel, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ dealTypeCode: t }), async: !1, success: function (t) { "true" == t ? redirectToLogin() : ($("#lblTitleLabel").text(t.Title_Label), "" != t.Title_Label ? $("#lblTitleCount").text(" ( " + t.Title_Count + " )") : $("#lblTitleCount").text(""), 0 == t.Title_Count && Enable_DisableControl(!1), $("#lblTitleSearchCount").text(t.Record_Count), $("input[name=hdnRecordCount]").val(t.Record_Count), e && ($("#ddlTitle_Search_List").empty(), $.each(t.Title_Search_List, function () { $("#ddlTitle_Search_List").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlTitle_Search_List")[0].sumo.reload()), SetPaging()) }, error: function (e) { alert("Error: " + e.responseText) } }) : ($("#lblTitleLabel").text(""), $("#lblTitleCount").text(""), $("#lblTitleSearchCount").text(0), $("input[name=hdnRecordCount]").val(0)) } function BindContactDropDown() { var e = getPrimaryLicensor(); e != $("#hdnPrimaryVendorCode").val() && ($("#hdnPrimaryVendorCode").val(e), $.ajax({ type: "POST", url: URL_BindContactDropDown, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ vendorCode: e }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : ($("#lblPhone").text(""), $("#lblEmail").text(""), $("#ddlContact").empty(), $.each(e, function () { $("#ddlContact").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlContact").trigger("chosen:updated")) }, error: function (e) { alert("Error: " + e.responseText) } })) } function ddlContact_OnChange() { var e = $("select[ID='ddlContact'] option:selected").val(); $.ajax({ type: "POST", url: URL_BindPrimaryContactDetail, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ vendorContactCode: e }), async: !1, success: function (e) { $("#lblPhone").text(e.Vendor_Phone), $("#lblEmail").text(e.Vendor_Email) }, error: function (e) { alert("Error: " + e.responseText) } }) } function BindTitlePopup(e, t, a, i) { $.ajax({ type: "POST", url: URL_BindTitlePopup, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ MasterDealMovieCode: e, dealTypeCode: t, replacingTitleCode: a }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : ($("#" + i).empty(), $.each(e, function () { $("#" + i).append($("<option />").val(this.Value).text(this.Text)) }), $("#" + i).trigger("chosen:updated")) }, error: function (e) { alert("Error: " + e.responseText) } }) } function SearchTitle(e) { if (!SaveTitleListData(!1)) return !1; $.ajax({ type: "POST", url: URL_SearchTitle, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ selectedTitleCodes: e }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : "S" == e.Status && ($("#lblTitleSearchCount").text(e.Record_Count), $("#hdnPageNo").val(1), BindTitleGridview(), addNumeric(), BindTitleLabel(!1)) }, error: function (e) { alert("Error: " + e.responseText) } }) } function btnSaveTitle_OnClick() { var e = $("#ddlTitle").val(); if ($("#divTitle").removeClass("required"), null != e) { if (showLoading(), Enable_DisableControl(!0), titleCodes = e.join(","), $("#popAddDealMovie").modal("hide"), valid = SaveTitleListData(!1), !valid) return !1; var t = GetDealTypeCode(); $.ajax({ type: "POST", url: URL_SaveTitle, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ titleCodes: titleCodes, dealTypeCode: t }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : "S" == e.Status && ($("#imgTitleIcon").prop("src", e.Title_Icon_Path), $("#divTitleIcon").attr("title", e.Title_Icon_Tooltip), BindTitleGridview(), addNumeric(), BindTitleLabel(!0), hideLoading()) }, error: function (e) { alert("Error: " + e.responseText) } }) } else $("#divTitle").addClass("required"), showAlert("E", ShowMessage.MsgForSelectTitle, "ddlTitle") } function Close_Title(e) { if (!ValidatePageSize()) return !1; var t = "E"; if ($.ajax({ type: "POST", url: URL_Close_Title, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ acqDealMovieCode: Acq_Deal_Movie_Code, notes: Notes, titleType: Title_Type, closingDate: $.trim(Movie_Closed_Date), closingRemark: $.trim(Closing_Remarks), episodeFrom: episode_From, episodeTo: episode_To, noOfEpisodes: no_Of_Episodes, confirmationDone: e }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : "S" == e.Status ? (t = "S", SetNull()) : "E" == e.Status && ("Y" == e.Show_Confirmation ? showAlert("I", e.Error_Message, "OKCANCEL") : (showAlert("E", e.Error_Message), t = "E")) }, error: function (e) { alert("Error: " + e.responseText) } }), "S" == t) { if (!SaveTitleListData(!1)) return !1; BindTitleGridview() } return "E" != t && void 0 } function SaveTitleListData(e) { var t = new Array, a = $("#tblMovie tr:not(:has(th))"), i = !0; if (e && (i = ValidateEpisodeOverlapping()), i) { var l = GetDealTypeCode(), o = GetDealTypeCondition(l), r = 0; a.each(function () { if ("deleted" != $(this).attr("class")) { var e = 0, a = "", i = "", n = 1, d = 1, s = 1, c = ""; e = parseInt($("#hdnTitleCode_" + r).val()), a = $("#hdnDummyGuid_" + r).val(), c = $("input[name='Acq_Deal_Movie[" + r + "].Title_Type']:radio:checked").val(), i = $("#txtNotes_" + r).val(), o == Deal_Music ? d = n = parseInt($("#txtEpisode_End_To_" + r).val()) : o == Deal_Program ? (n = parseInt($("#txtEpisode_Starts_From_" + r).val()), d = parseInt($("#txtEpisode_End_To_" + r).val()), l == Deal_Type_Sports && (n = 1)) : o == Sub_Deal_Talent && (s = parseInt($("#txtNo_Of_Episodes_" + r).val())), t.push({ Title_Code: e, _Dummy_Guid: a, Notes: i, Episode_Starts_From: n, Episode_End_To: d, No_Of_Episodes: s, Title_Type: c }) } r += 1 }), $.ajax({ type: "POST", url: URL_SaveTitleListData, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ titleList: t }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : "E" == e.Status && (showAlert("E", e.Error_Message), i = !1) }, error: function (e) { alert("Error: " + e.responseText) } }) } return i } function tblMovie_RowCommand(e, t, a) { if ($(".required").removeClass("required"), $("[required='required']").removeAttr("required"), !ValidatePageSize()) return !1; Dummy_Guid = e, Row_Index = t, Command_Name = a, txtMovie_Closed_Date = $("#txtMovie_Closed_Date_" + t), txtClosing_Remarks = $("#txtClosing_Remarks_" + t); var i = $("#lblMovie_Closed_Date_" + t), l = ($("#lblClosing_Remarks_" + t), $("#divClosing_Remarks_" + t)), o = $("#ddlTitle_" + t), r = $("#divTitle_" + t), n = $("#lblTitleName_" + t), d = $("#hdnTitleCode_" + t), s = $("#lblStarCast_" + t), c = $("#lblDuration_" + t), _ = $("#lblTitleLangName_" + t), u = $("#btnSave_" + t), p = $("#btnCancel_" + t), h = $("#btnDelete_" + t), m = $("#btnCloseTitle_" + t), T = $("#btnReplace_" + t); Movie_Closed_Date = null != txtMovie_Closed_Date && "undefined" != txtMovie_Closed_Date ? txtMovie_Closed_Date.val() : "", Closing_Remarks = null != txtClosing_Remarks && "undefined" != txtClosing_Remarks ? txtClosing_Remarks.val() : ""; var v = $.trim($("#" + t + "_hdnTitleClosedDate").val()); Acq_Deal_Movie_Code = $("#hdnAcq_Deal_Movie_Code_" + t).val(), Title_Type = $("input[name='Acq_Deal_Movie[" + t + "].Title_Type']:radio:checked").val(), Notes = $("#txtNotes_" + t).val(); var C = GetDealTypeCode(), D = GetDealTypeCondition(C); if (episode_From = 1, episode_To = 1, no_Of_Episodes = 1, D == Deal_Music ? episode_To = episode_From = parseInt($("#txtEpisode_End_To_" + t).val()) : D == Deal_Program ? (episode_From = parseInt($("#txtEpisode_Starts_From_" + t).val()), episode_To = parseInt($("#txtEpisode_End_To_" + t).val()), C == Deal_Type_Sports && (episode_From = 1)) : D == Sub_Deal_Talent && (txtNo_Of_Episodes = $("#txtNo_Of_Episodes_" + t), 0 == txtNo_Of_Episodes.length ? no_Of_Episodes = 1 : no_Of_Episodes = parseInt(txtNo_Of_Episodes.val())), "DELETE" == a) { var g = !1, f = "S", y = $("#ddlTitle_Search_List").val(); $.ajax({ type: "POST", url: URL_DeleteTitle, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ Dummy_Guid: e, acqDealMovieCode: Acq_Deal_Movie_Code, searchCodes: "" }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : "S" == e.Status ? ($("#imgTitleIcon").prop("src", e.Title_Icon_Path), $("#divTitleIcon").attr("title", e.Title_Icon_Tooltip), $("#tblMovie_tr_" + t).addClass("deleted"), g = e.Bind_Search) : (f = "E", showAlert("E", e.Error_Message)) }, error: function (e) { alert("Error: " + e.responseText) } }), SetNull(), "S" == f && (SaveTitleListData(!1), BindTitleGridview(), addNumeric(), BindTitleLabel(g), null != y && g && $("select#ddlTitle_Search_List.form_input.chosen-select").val(y).trigger("chosen:updated")) } else if ("CLOSE_TITLE" == a) i.hide(), l.hide(), txtMovie_Closed_Date.show(), txtClosing_Remarks.show(), h.hide(), m.hide(), u.show(), p.show(); else if ("SAVE_CLOSED_TITLE" == a) { if (!(E = ValidateEpisodeOverlapping())) return !1; if ("" == txtMovie_Closed_Date.val()) return txtMovie_Closed_Date.attr("required", !0), !1; Command_Name = "SAVE_CLOSED_TITLE", Close_Title("N") || txtMovie_Closed_Date.val(v) } else if ("CANCEL_CLOSE_TITLE" == a) i.show(), l.show(), txtMovie_Closed_Date.hide(), txtClosing_Remarks.hide(), h.show(), m.show(), u.hide(), p.hide(), SetNull(); else if ("REPLACE_TITLE" == a) r.show(), n.hide(), T.hide(), h.hide(), u.show(), p.show(), BindTitlePopup($("select[ID='ddlMaster_Deal_List'] option:selected").val(), C = GetDealTypeCode(), parseInt(d.val()), o[0].id), initializeChosen(), o.val(d.val()), o.trigger("chosen:updated"); else if ("SAVE_REPLACE_TITLE" == a) { var S = o.val(), L = d.val(); d.val(S); var E = ValidateEpisodeOverlapping(); if (!E) return d.val(L), !1; $.ajax({ type: "POST", url: URL_Replace_Title, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ dummyGuid: e, titleCode: S, notes: Notes, titleType: Title_Type, episodeFrom: episode_From, episodeTo: episode_To, noOfEpisodes: no_Of_Episodes }), async: !1, success: function (e) { "true" == e ? redirectToLogin() : "S" == e.Status ? (r.hide(), n.show(), n.text(e.Title_Name), _.text(e.Title_Language_Name), s.text(e.Star_Cast), c.text(e.Duration_In_Min), h.show(), T.show(), u.hide(), p.hide(), SetNull()) : "E" == e.Status && (d.val(L), showAlert("E", e.Error_Message)) }, error: function (e) { alert("Error: " + e.responseText) } }) } else "CANCEL_REPLACE_TITLE" == a && (r.hide(), n.show(), h.show(), T.show(), u.hide(), p.hide(), SetNull()) } function handleOk() { "SAVE_CLOSED_TITLE" == Command_Name ? Close_Title("Y") : "DELETE" == Command_Name || "CLOSE_TITLE" == Command_Name || "REPLACE_TITLE" == Command_Name ? tblMovie_RowCommand(Dummy_Guid, Row_Index, Command_Name) : "REDIRECT_PAGE" == Command_Name ? window.location.href = Redirect_URL : "CANCEL_SAVE_DEAL" == Command_Name && (location.href = URL_Cancel) } function handleCancel() { SetNull() } function ValidateSave() { if (!ValidatePageSize()) return !1; if (clickedOnTab ? $("input[name=hdnReopenMode]").val("E") : "SAVE & APPROVE" == $(event.target).val().toUpperCase() ? $("input[name=hdnReopenMode]").val("RO") : $("input[name=hdnReopenMode]").val("E"), "" == Command_Name && (Command_Name = null), null != Command_Name) return showAlert("E", ShowMessage.MsgForAddEdit), !1; if ($(".required").removeClass("required"), $("[required='required']").removeAttr("required"), !RequiredFieldValidation()) return !1; if (!ValidateEpisodeOverlapping()) return !1; $("input[name=hdnIs_Master_Deal]").val($("input[name='Is_Master_Deal']:radio:checked").val()), $("input[name=hdnMaster_Deal_Movie_Code]").val($("select[ID='ddlMaster_Deal_List'] option:selected").val()), $("input[name=hdnDeal_Type_Code]").val(GetDealTypeCode()); var e = $("#ddlLicensor").val(); return $("input[name=hdnVendorCodes]").val(e.join(",")), $("input[name=hdnAgreementDate]").val($("input[ID='txtAgreement_Date']").val()), $("input[name=hdnDealDesc]").val($("input[ID='txtDeal_Desc']").val()), $("input[name=hdnDealTagStatusCode]").val($("select[ID='ddlDeal_Tag'] option:selected").val()), showLoading(), !0 } function Save_Success(e) { return "true" == e ? redirectToLogin() : (status = e.Status, "S" == e.Status || "SA" == e.Status ? ("SA" == e.Status && $.ajax({ type: "POST", url: URL_Approve_Reject_Reopen, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", data: JSON.stringify({ user_Action: "A", approvalremarks: "" }), async: !1, success: function (e) { } }), "" != e.Success_Message ? (Command_Name = "REDIRECT_PAGE", Redirect_URL = e.Redirect_URL, RedirectTab = e.TabName, showAlert("S", e.Success_Message, "OK")) : (BindPartialTabs(e.TabName), BindTopAcqDetails())) : void 0 == e.Status ? (Command_Name = null, Redirect_URL = null, RedirectTab = null, window.location.href = URL_Login_Index) : "E" == e.Status && (Command_Name = null, Redirect_URL = null, RedirectTab = null, $("#hdnTabName").val(""), "" != e.Error_Message && showAlert("E", e.Error_Message), e.Error_Page_Index > 0 && ($("#hdnPageNo").val(e.Error_Page_Index), $("#hdnRecordCount").val(e.Total_Record_Count), $("#ddlTitle_Search_List").val("").trigger("chosen:updated"), BindTitleGridview(), SetPaging(), ValidateEpisodeOverlapping()))), hideLoading(), !1 } function BindAllPreReq_Async() { showLoading(), $.ajax({ type: "POST", url: URL_BindAllPreReq_Async, traditional: !0, enctype: "multipart/form-data", contentType: "application/json; charset=utf-8", async: !0, success: function (e) { "true" == e ? redirectToLogin() : ($.each(e.Category_List, function () { $("#ddlCategory").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlCategory").val(e.Category_Code), $.each(e.Licensee_List, function () { $("#ddlLicensee").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlLicensee").val(e.Entity_Code), $.each(e.Business_Unit_List, function () { $("#ddlBusinessUnit").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlBusinessUnit").val(e.Business_Unit_Code), $.each(e.Currency_List, function () { $("#ddlCurrency").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlCurrency").val(e.Currency_Code), $.each(e.Licensor_List, function () { $("#ddlLicensor").append($("<option />").val(this.Value).text(this.Text)) }), vendorCode > 0 && $("input[name=hdnPrimaryVendorCode]").val(vendorCode), "" != vendorCodes && $("select#ddlLicensor.form_input.chosen-select").val(vendorCodes.split(",")), $.each(e.Master_Deal_List, function () { $("#ddlMaster_Deal_List").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlMaster_Deal_List").val(e.Master_Deal_Movie_Code), $.each(e.Vendor_Contact_List, function () { $("#ddlContact").append($("<option />").val(this.Value).text(this.Text)) }), $("#ddlContact").val(e.Vendor_Contact_Code), $("#ddlCategory,#ddlLicensee,#ddlBusinessUnit,#ddlCurrency,#ddlContact").trigger("chosen:updated"), $("#ddlLicensor").chosen().trigger("chosen:updated"), $("#ddlLicensor").on("change", function (e, t) { AllowChosenRightClick() }), AllowChosenRightClick(), setPrimaryLicensor(vendorCode), $("#ddlMaster_Deal_List").trigger("chosen:updated"), $("#btnAddTitle").removeAttr("disabled"), BindTitleGridview(), BindTitleLabel(!0), $("select#ddlTitle_Search_List.form_input.chosen-select").val(generalSearchTitleCodes.split(",")).trigger("chosen:updated"), addNumeric(), hideLoading()) }, error: function (e) { alert("Error: " + e.responseText) } }) } $(document).ready(function () { if ($(".modal").modal({ backdrop: "static", keyboard: !1, show: !1 }), showLoading(), recordLockingCode > 0) { var e = URL_Refresh_Lock; Call_RefreshRecordReleaseTime(recordLockingCode, e) } $(".nav-tabs li.active input").attr("disabled", "disabled"), acqDealMovie_Count > 0 ? Enable_DisableControl(!0) : "Y" == isMasterDeal && ($("select[ID='ddlMaster_Deal_List']").attr("disabled", !0), $("select[ID='ddlOther']").attr("disabled", !0), $(".chosen-select:not(#ddlLicensor)").trigger("chosen:updated")), parentCode > 0 && $("input[name=Deal_Type_Code][value='" + parentCode + "']").prop("checked", "checked"), $("#txtAgreement_Date").datepicker("option", "maxDate", new Date), ChangeLabelName(), $("input[name=hdnPrimaryVendorCode]").val(vendorCode), generalPageNo > 0 && generalPageSize > 0 ? ($("#txtPageSize").val(generalPageSize), $("#hdnPageNo").val(generalPageNo)) : ($("#txtPageSize").val("10"), $("#hdnPageNo").val("1")); var t = document.getElementById("txtRemark"); countChar(t), hideLoading(), BindAllPreReq_Async() });